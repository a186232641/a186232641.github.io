<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>搭建v2ray+tls+ws</title>
      <link href="/2023/08/24/%E6%90%AD%E5%BB%BAv2ray-tls-ws/"/>
      <url>/2023/08/24/%E6%90%AD%E5%BB%BAv2ray-tls-ws/</url>
      
        <content type="html"><![CDATA[<h1 id="v2ray-tls-ws搭建小白教程"><a href="#v2ray-tls-ws搭建小白教程" class="headerlink" title="v2ray+tls+ws搭建小白教程"></a>v2ray+tls+ws搭建小白教程</h1><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><ol><li><p>已经购买好的域名</p></li><li><p>国外的vps</p></li><li><p>cloudfare解析好域名</p><p>注意：搭建过程中不能开启小云朵</p></li></ol><h2 id="开始搭建"><a href="#开始搭建" class="headerlink" title="开始搭建"></a>开始搭建</h2><h3 id="连接vps"><a href="#连接vps" class="headerlink" title="连接vps"></a>连接vps</h3><p>略，这部分自行查阅教程</p><h3 id="更新Linux系统包"><a href="#更新Linux系统包" class="headerlink" title="更新Linux系统包"></a>更新Linux系统包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">apt update<br></code></pre></td></tr></table></figure><h3 id="安装curl"><a href="#安装curl" class="headerlink" title="安装curl"></a>安装curl</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">apt install curl<br></code></pre></td></tr></table></figure><h3 id="安装v2ray"><a href="#安装v2ray" class="headerlink" title="安装v2ray"></a>安装v2ray</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash &lt;(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)<br></code></pre></td></tr></table></figure><h3 id="配置v2ray"><a href="#配置v2ray" class="headerlink" title="配置v2ray"></a>配置v2ray</h3><p>在命令行输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /usr/local/etc/v2ray/config.json<br></code></pre></td></tr></table></figure><p>将下面的代码粘贴到config.json文件中,文件中<strong>port</strong>、<strong>id</strong>、<strong>path</strong>可以修改为自己想要设定的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ison">&#123;<br>    &quot;log&quot;: &#123;<br>        &quot;access&quot;: &quot;/var/log/v2ray/access.log&quot;,<br>        &quot;error&quot;: &quot;/var/log/v2ray/error.log&quot;,<br>        &quot;loglevel&quot;: &quot;warning&quot;<br>    &#125;,<br>    &quot;inbounds&quot;: [&#123;<br>            &quot;port&quot;: 11055,<br>            &quot;protocol&quot;: &quot;vmess&quot;,<br>            &quot;settings&quot;: &#123;<br>                &quot;clients&quot;: [&#123;<br>                        &quot;id&quot;: &quot;27848739-7e62-4138-9fd3-098a63964b6b&quot;,<br>                        &quot;level&quot;: 1,<br>                        &quot;alterId&quot;: 0<br>                    &#125;<br>                ]<br>            &#125;,<br>            &quot;streamSettings&quot;: &#123;<br>                &quot;network&quot;: &quot;ws&quot;,<br>                &quot;wsSettings&quot;: &#123;<br>                    &quot;path&quot;: &quot;/tech&quot;<br>                &#125;<br>            &#125;<br>        &#125;<br>    ],<br><br>    &quot;outbounds&quot;: [&#123;<br>            &quot;protocol&quot;: &quot;freedom&quot;<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="启动v2ray服务"><a href="#启动v2ray服务" class="headerlink" title="启动v2ray服务"></a>启动v2ray服务</h3><p>启动v2ray</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start v2ray<br></code></pre></td></tr></table></figure><p>将v2ray设置成开机自动启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl enable v2ray<br></code></pre></td></tr></table></figure><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><p> 执行安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt install -y nginx<br></code></pre></td></tr></table></figure><p>新建网页目录</p><p>这里的网页目录设置为/root/www(可以更换)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /root/www<br></code></pre></td></tr></table></figure><p> 新建首页</p><p>在/root/www目录下新建index.html</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /root/www/index.html<br></code></pre></td></tr></table></figure><p>内容如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎来到我的网站<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;styles.css&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>欢迎来到我的网站<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><p>命令行输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/nginx/nginx.conf<br></code></pre></td></tr></table></figure><p>将以下配置粘贴到nginx.conf文件中http下,并将第一行user www-data改为user root，即当前用户。</p><p>Server_name是cloudfare中DNS解析好的域名</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">server<span class="hljs-punctuation">&#123;</span><br>    listen <span class="hljs-number">80</span>;<br>    server_name v1.xxxx.com;<br>    index index.html;<br>    root /root/www/;<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start nginx<br></code></pre></td></tr></table></figure><p> 将v2ray设置成开机自动启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl enable nginx<br></code></pre></td></tr></table></figure><p> 查看nginx启动状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl status nginx<br></code></pre></td></tr></table></figure><p>常用的nginx命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart nginx  #重启nginx<br>nginx -t #检查nginx.conf是否有错误<br></code></pre></td></tr></table></figure><p> 验证nginx是否配置成功</p><p>在浏览器里访问<code>v1.xxxx.com</code>，如果正常则说明nginx配置没问题，这是是没有加密的，不带HTTPS的网址：<code>http://v1.xxxx.com</code>。</p><h3 id="安装certbot并申请SSL证书"><a href="#安装certbot并申请SSL证书" class="headerlink" title="安装certbot并申请SSL证书"></a>安装certbot并申请SSL证书</h3><p> 安装snapd</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt install -y snapd<br></code></pre></td></tr></table></figure><p> 确保snapd为最新版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">snap install core; snap refresh core<br></code></pre></td></tr></table></figure><p> 安装certbot</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">snap install --classic certbot<br></code></pre></td></tr></table></figure><p> 创建软链</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s /snap/bin/certbot /usr/bin/certbot<br></code></pre></td></tr></table></figure><p> 申请证书</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">certbot --nginx<br></code></pre></td></tr></table></figure><p><img src="/2023/08/24/%E6%90%AD%E5%BB%BAv2ray-tls-ws/install-v2ray-on-debian-2021-1.jpg" alt="install-v2ray-on-debian-2021-1" style="zoom:50%;"></p><p>稍等一会，会提示证书安装成功！ 你会发现nginx的配置已经更改，我的<code>/etc/nginx/sites-enabled/default</code>文件被自动修改为以下内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs json">server<span class="hljs-punctuation">&#123;</span><br>    server_name v1.xxxx.com;<br>    index index.html;<br>    root /root/www/;<br><br>    listen <span class="hljs-number">443</span> ssl; # managed by Certbot<br>    ssl_certificate /etc/letsencrypt/live/v1.xxxx.com/fullchain.pem; # managed by Certbot<br>    ssl_certificate_key /etc/letsencrypt/live/v1.xxxx.com/privkey.pem; # managed by Certbot<br>    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot<br>    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot<br><br><span class="hljs-punctuation">&#125;</span><br>server<span class="hljs-punctuation">&#123;</span><br>    if ($host = v1.xxxx.com) <span class="hljs-punctuation">&#123;</span><br>        return <span class="hljs-number">301</span> https<span class="hljs-punctuation">:</span><span class="hljs-comment">//$host$request_uri;</span><br>    <span class="hljs-punctuation">&#125;</span> # managed by Certbot<br><br><br>    listen <span class="hljs-number">80</span>;<br>    server_name v1.xxxx.com;<br>    return <span class="hljs-number">404</span>; # managed by Certbot<br><br><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>此时，在浏览器里访问v1.xxxx.com已经是https开头的了，地址：    <code>https://v1.xxxx.com</code>。</p><h3 id="添加v2ray转发"><a href="#添加v2ray转发" class="headerlink" title="添加v2ray转发"></a>添加v2ray转发</h3><p>将/etc/nginx/nginx.conf更改为以下内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs json">server<span class="hljs-punctuation">&#123;</span><br>    server_name v1.xxxx.com;<br>    index index.html;<br>    root /root/www/;<br><br>    listen <span class="hljs-number">443</span> ssl; # managed by Certbot<br>    ssl_certificate /etc/letsencrypt/live/v1.xxxx.com/fullchain.pem; # managed by Certbot<br>    ssl_certificate_key /etc/letsencrypt/live/v1.xxxx.com/privkey.pem; # managed by Certbot<br>    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot<br>    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot<br><br>   ## 添加这部分内容<span class="hljs-punctuation">,</span><span class="hljs-number">22055</span>对应/usr/local/etc/v2ray/config.json 里面inbounds端口<br>   ## /tech客户端配置的时候需要<span class="hljs-punctuation">,</span>对应/usr/local/etc/v2ray/config.json streamSettings里的path<br>    location /tech <span class="hljs-punctuation">&#123;</span><br>        proxy_redirect off;<br>        proxy_pass http<span class="hljs-punctuation">:</span><span class="hljs-comment">//127.0.0.1:11055;</span><br>        proxy_http_version <span class="hljs-number">1.1</span>;<br>        proxy_set_header Upgrade $http_upgrade;<br>        proxy_set_header Connection <span class="hljs-string">&quot;upgrade&quot;</span>;<br>        proxy_set_header Host $http_host;<br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>server<span class="hljs-punctuation">&#123;</span><br>    if ($host = v1.xxxx.com) <span class="hljs-punctuation">&#123;</span><br>        return <span class="hljs-number">301</span> https<span class="hljs-punctuation">:</span><span class="hljs-comment">//$host$request_uri;</span><br>    <span class="hljs-punctuation">&#125;</span> # managed by Certbot<br><br><br>    listen <span class="hljs-number">80</span>;<br>    server_name v1.xxxx.com;<br>    return <span class="hljs-number">404</span>; # managed by Certbot<br><br><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><strong>注意这里的11055、 /tech</strong>要修改为v2ray对应的值，v1.xxxx.com是你已经解析好的域名</p><p>然后运行,重启nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart nginx<br></code></pre></td></tr></table></figure><p>下面是我在shadowrocket配置</p><p><img src="/2023/08/24/%E6%90%AD%E5%BB%BAv2ray-tls-ws/截屏2023-08-24 13.42.40.png" alt="截屏2023-08-24 13.42.40"></p><p><img src="/2023/08/24/%E6%90%AD%E5%BB%BAv2ray-tls-ws/截屏2023-08-24 13.43.32.png" alt="截屏2023-08-24 13.43.32"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 科学上网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>first blog</title>
      <link href="/2023/08/23/first-blog/"/>
      <url>/2023/08/23/first-blog/</url>
      
        <content type="html"><![CDATA[<h1 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h1><p>this is my first blog to celebrate the blog website</p>]]></content>
      
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>标签</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
