<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>搭建v2ray+tls+ws</title>
      <link href="/2023/08/24/%F0%9F%AA%9C/"/>
      <url>/2023/08/24/%F0%9F%AA%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="v2ray-tls-ws-搭建小白教程"><a href="#v2ray-tls-ws-搭建小白教程" class="headerlink" title="v2ray+tls+ws 搭建小白教程"></a>v2ray+tls+ws 搭建小白教程</h1><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><ol><li><p>已经购买好的域名</p></li><li><p>国外的 vps</p></li><li><p>cloudfare 解析好域名</p><p>注意：搭建过程中不能开启小云朵</p></li></ol><h2 id="开始搭建"><a href="#开始搭建" class="headerlink" title="开始搭建"></a>开始搭建</h2><h3 id="连接-vps"><a href="#连接-vps" class="headerlink" title="连接 vps"></a>连接 vps</h3><p>略，这部分自行查阅教程</p><h3 id="更新-Linux-系统包"><a href="#更新-Linux-系统包" class="headerlink" title="更新 Linux 系统包"></a>更新 Linux 系统包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure><h3 id="安装-curl"><a href="#安装-curl" class="headerlink" title="安装 curl"></a>安装 curl</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install curl</span><br></pre></td></tr></table></figure><h3 id="安装-v2ray"><a href="#安装-v2ray" class="headerlink" title="安装 v2ray"></a>安装 v2ray</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)</span><br></pre></td></tr></table></figure><h3 id="配置-v2ray"><a href="#配置-v2ray" class="headerlink" title="配置 v2ray"></a>配置 v2ray</h3><p>在命令行输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/etc/v2ray/config.json</span><br></pre></td></tr></table></figure><p>将下面的代码粘贴到 config.json 文件中,文件中<strong>port</strong>、<strong>id</strong>、<strong>path</strong>可以修改为自己想要设定的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;log&quot;: &#123;</span><br><span class="line">        &quot;access&quot;: &quot;/var/log/v2ray/access.log&quot;,</span><br><span class="line">        &quot;error&quot;: &quot;/var/log/v2ray/error.log&quot;,</span><br><span class="line">        &quot;loglevel&quot;: &quot;warning&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;inbounds&quot;: [&#123;</span><br><span class="line">            &quot;port&quot;: 11055,</span><br><span class="line">            &quot;protocol&quot;: &quot;vmess&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;clients&quot;: [&#123;</span><br><span class="line">                        &quot;id&quot;: &quot;27848739-7e62-4138-9fd3-098a63964b6b&quot;,</span><br><span class="line">                        &quot;level&quot;: 1,</span><br><span class="line">                        &quot;alterId&quot;: 0</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;streamSettings&quot;: &#123;</span><br><span class="line">                &quot;network&quot;: &quot;ws&quot;,</span><br><span class="line">                &quot;wsSettings&quot;: &#123;</span><br><span class="line">                    &quot;path&quot;: &quot;/tech&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    &quot;outbounds&quot;: [&#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;freedom&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="启动-v2ray-服务"><a href="#启动-v2ray-服务" class="headerlink" title="启动 v2ray 服务"></a>启动 v2ray 服务</h3><p>启动 v2ray</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start v2ray</span><br></pre></td></tr></table></figure><p>将 v2ray 设置成开机自动启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable v2ray</span><br></pre></td></tr></table></figure><h3 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h3><p>执行安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y nginx</span><br></pre></td></tr></table></figure><p>新建网页目录</p><p>这里的网页目录设置为/root/www(可以更换)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /root/www</span><br></pre></td></tr></table></figure><p>新建首页</p><p>在/root/www 目录下新建 index.html</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /root/www/index.html</span><br></pre></td></tr></table></figure><p>内容如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎来到我的网站<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎来到我的网站<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置-nginx"><a href="#配置-nginx" class="headerlink" title="配置 nginx"></a>配置 nginx</h3><p>命令行输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>将以下配置粘贴到 nginx.conf 文件中 http 下,并将第一行 user www-data 改为 user root，即当前用户。</p><p>Server_name 是 cloudfare 中 DNS 解析好的域名</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server<span class="punctuation">&#123;</span></span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name v1.xxxx.com;</span><br><span class="line">    index index.html;</span><br><span class="line">    root /root/www/;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="启动-nginx"><a href="#启动-nginx" class="headerlink" title="启动 nginx"></a>启动 nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure><p>将 v2ray 设置成开机自动启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure><p>查看 nginx 启动状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure><p>常用的 nginx 命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx  #重启nginx</span><br><span class="line">nginx -t #检查nginx.conf是否有错误</span><br></pre></td></tr></table></figure><p>验证 nginx 是否配置成功</p><p>在浏览器里访问<code>v1.xxxx.com</code>，如果正常则说明 nginx 配置没问题，这是是没有加密的，不带 HTTPS 的网址：<code>http://v1.xxxx.com</code>。</p><h3 id="安装-certbot-并申请-SSL-证书"><a href="#安装-certbot-并申请-SSL-证书" class="headerlink" title="安装 certbot 并申请 SSL 证书"></a>安装 certbot 并申请 SSL 证书</h3><p>安装 snapd</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y snapd</span><br></pre></td></tr></table></figure><p>确保 snapd 为最新版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snap install core; snap refresh core</span><br></pre></td></tr></table></figure><p>安装 certbot</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snap install --classic certbot</span><br></pre></td></tr></table></figure><p>创建软链</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /snap/bin/certbot /usr/bin/certbot</span><br></pre></td></tr></table></figure><p>申请证书</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot --nginx</span><br></pre></td></tr></table></figure><p><img src="/2023/08/24/%F0%9F%AA%9C/install-v2ray-on-debian-2021-1.jpg" alt="install-v2ray-on-debian-2021-1" style="zoom:50%;"></p><p>稍等一会，会提示证书安装成功！ 你会发现 nginx 的配置已经更改，我的<code>/etc/nginx/sites-enabled/default</code>文件被自动修改为以下内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">server<span class="punctuation">&#123;</span></span><br><span class="line">    server_name v1.xxxx.com;</span><br><span class="line">    index index.html;</span><br><span class="line">    root /root/www/;</span><br><span class="line"></span><br><span class="line">    listen <span class="number">443</span> ssl; # managed by Certbot</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/v1.xxxx.com/fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/v1.xxxx.com/privkey.pem; # managed by Certbot</span><br><span class="line">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">server<span class="punctuation">&#123;</span></span><br><span class="line">    if ($host = v1.xxxx.com) <span class="punctuation">&#123;</span></span><br><span class="line">        return <span class="number">301</span> https<span class="punctuation">:</span><span class="comment">//$host$request_uri;</span></span><br><span class="line">    <span class="punctuation">&#125;</span> # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name v1.xxxx.com;</span><br><span class="line">    return <span class="number">404</span>; # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>此时，在浏览器里访问 v1.xxxx.com 已经是 https 开头的了，地址： <code>https://v1.xxxx.com</code>。</p><h3 id="添加-v2ray-转发"><a href="#添加-v2ray-转发" class="headerlink" title="添加 v2ray 转发"></a>添加 v2ray 转发</h3><p>将/etc/nginx/nginx.conf 更改为以下内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">server<span class="punctuation">&#123;</span></span><br><span class="line">    server_name v1.xxxx.com;</span><br><span class="line">    index index.html;</span><br><span class="line">    root /root/www/;</span><br><span class="line"></span><br><span class="line">    listen <span class="number">443</span> ssl; # managed by Certbot</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/v1.xxxx.com/fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/v1.xxxx.com/privkey.pem; # managed by Certbot</span><br><span class="line">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line">   ## 添加这部分内容<span class="punctuation">,</span><span class="number">22055</span>对应/usr/local/etc/v2ray/config.json 里面inbounds端口</span><br><span class="line">   ## /tech客户端配置的时候需要<span class="punctuation">,</span>对应/usr/local/etc/v2ray/config.json streamSettings里的path</span><br><span class="line">    location /tech <span class="punctuation">&#123;</span></span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_pass http<span class="punctuation">:</span><span class="comment">//127.0.0.1:11055;</span></span><br><span class="line">        proxy_http_version <span class="number">1.1</span>;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">server<span class="punctuation">&#123;</span></span><br><span class="line">    if ($host = v1.xxxx.com) <span class="punctuation">&#123;</span></span><br><span class="line">        return <span class="number">301</span> https<span class="punctuation">:</span><span class="comment">//$host$request_uri;</span></span><br><span class="line">    <span class="punctuation">&#125;</span> # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name v1.xxxx.com;</span><br><span class="line">    return <span class="number">404</span>; # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>注意这里的 11055、 /tech</strong>要修改为 v2ray 对应的值，v1.xxxx.com 是你已经解析好的域名</p><p>然后运行,重启 nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure><p>下面是我在 shadowrocket 配置</p><p><img src="/2023/08/24/%F0%9F%AA%9C/截屏2023-08-24 13.42.40.png" alt="截屏2023-08-24 13.42.40"></p><p><img src="/2023/08/24/%F0%9F%AA%9C/截屏2023-08-24 13.43.32.png" alt="截屏2023-08-24 13.43.32"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 科学上网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>first blog</title>
      <link href="/2023/08/23/first-blog/"/>
      <url>/2023/08/23/first-blog/</url>
      
        <content type="html"><![CDATA[<h1 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h1><p>this is my first blog to celebrate the blog website</p>]]></content>
      
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>标签</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
